---
title: 匹配数据统一的实体
description: 匹配实体以创建统一客户配置文件。
ms.date: 02/23/2021
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
ms.openlocfilehash: 2eb84c44aa530346a73ba720106734d705a45f23
ms.sourcegitcommit: bae40184312ab27b95c140a044875c2daea37951
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/15/2021
ms.locfileid: "5595553"
---
# <a name="match-entities"></a>匹配实体

匹配阶段指定如何将数据集合并为一个统一的客户配置文件数据集。 在数据统一过程中完成[映射步骤](map-entities.md)后，就可以匹配实体了。 匹配阶段需要至少两个映射的实体。

匹配页由三个部分组成： 
- 对匹配记录数进行汇总的关键指标
- 跨实体匹配的匹配顺序和规则
- 匹配实体的删除重复规则

## <a name="specify-the-match-order"></a>指定匹配顺序

转到 **数据** > **统一** > **匹配**，并选择 **设置顺序** 以开始匹配阶段。

每个匹配将两个或多个实体统一为一个合并实体。 同时，它将保留唯一的客户记录。 例如，我们选择了以下两个实体：**eCommerce:eCommerceContacts**（作为主要实体）和 **LoyaltyScheme:loyCustomers**（作为第二个实体）。 实体的顺序指定了系统尝试匹配记录的顺序。

:::image type="content" source="media/match-page.png" alt-text="数据统一过程的“统一”区域中“匹配”页的屏幕截图。":::
  
主要实体 *eCommerce:eCommerceContacts* 与下一个实体 *LoyaltyScheme:loyCustomers* 匹配。 如果您有两个以上的实体，则将第一个匹配步骤产生的数据集与以下实体进行匹配。

> [!IMPORTANT]
> 选择作为主实体的实体将充当统一配置文件数据集的基础。 将把匹配阶段选择的其他实体添加到此实体。 这并不意味着统一实体将包括此实体中包含的 *所有* 数据。
>
> 可帮助您选择实体层次结构的注意事项有两个：
>
> - 选择具有最完整、最可靠的客户配置文件数据的实体作为主要实体。
> - 选择与其他实体一样具有多个属性（如名称、电话号码或电子邮件地址）的实体作为主要实体。

指定匹配顺序后，在 **数据** > **统一** > **匹配** 上的 **匹配记录详细信息** 部分中，您将会看到定义的匹配对。 在匹配过程完成之前，关键指标将为空。

## <a name="define-rules-for-match-pairs"></a>定义匹配对的规则

匹配规则指定匹配一对特定实体时所用逻辑。

实体名称旁边的 **需要规则** 警告表示没有为匹配对定义匹配规则。 

:::image type="content" source="media/match-rule-add.png" alt-text="“匹配的记录详细信息”部分的屏幕截图，其中突出显示了用于添加规则的控件。":::

1. 在 **匹配的记录详细信息** 部分中的实体下面选择 **添加规则** 以定义匹配规则。

1. 在 **创建规则** 窗格中，配置规则的条件。

   :::image type="content" source="media/match-rule-conditions.png" alt-text="添加了条件的已开启匹配规则的屏幕截图。":::

   - **实体/字段（第一行）**：选择相关实体和属性，以指定客户可能特有的记录属性。 例如，电话号码或电子邮件地址。 避免按活动-类型属性进行匹配。 例如，购买 ID 可能在其他记录类型中找不到匹配项。

   - **实体/字段（第二行）**：选择与第一行中指定的实体属性相关的属性。

   - **标准化**：为所选属性从以下标准化选项中进行选择。 
     - 空白：删除所有空格。 *Hello   World* 会变为 *HelloWorld*。
     - 符号：删除所有符号和特殊字符。 *Head&Shoulder* 会变为 *HeadShoulder*。
     - 文本转换为小写：将所有字符转换为小写。 *ALL CAPS and Title Case* 将变为 *all caps and title case*。
     - Unicode 转变为 ASCII：将 Unicode 表示法转换为 ASCII 字符。 */u00B2* 将变为 *2*。
     - 数字：将其他数字系统（如罗马数字）转换为阿拉伯语数字。 *VIII* 将变为 *8*。
     - 语义类型：对名称、职称、电话号码、地址等进行标准化处理。 

   - **精度**：设置要用于此条件的精度级别。 
     - **基本**：从 *低*、*中*、*高* 和 *精确* 中选择。 如果选择 **精确**，则仅匹配 100% 匹配的记录。 选择其他一种级别则匹配不是 100% 相同的记录。
     - **自定义**：设置记录需要匹配的百分比。 系统将只匹配传递此阈值的记录。

1. 为规则提供 **名称**。

1. [添加更多条件](#add-conditions-to-a-rule)或选择 **完成** 以最终确定该规则。

1. （可选）[添加更多规则](#add-rules-to-a-match-pair)。

1. 选择 **保存** 以应用您所做的更改。

### <a name="add-conditions-to-a-rule"></a>向规则添加条件

要仅在属性满足多个条件时才匹配实体，请向匹配规则中添加更多条件。 条件与逻辑 AND 运算符相连，因此仅在满足所有条件时才会执行。

1. 转到 **数据** > **统一** > **匹配**，并对要向其添加条件的规则选择 **编辑**。

1. 在 **编辑规则** 窗格中，选择 **添加条件**。

1. 选择 **完成** 保存规则。

### <a name="add-rules-to-a-match-pair"></a>向匹配对中添加规则

匹配规则表示条件集。 要根据多个属性按条件匹配实体，请添加更多规则

1.  转到 **数据** > **统一** > **匹配**，并对要向其添加规则的实体选择 **添加规则**。

2. 按照[定义匹配对的规则](#define-rules-for-match-pairs)中的步骤操作。

> [!NOTE]
> 规则的顺序很重要。 匹配算法会尝试基于您的第一个规则进行匹配，并且仅在第一个规则没有找到匹配项时才会继续应用第二个规则。

## <a name="define-deduplication-on-a-match-entity"></a>对匹配实体定义删除重复

除了[跨实体匹配规则](#define-rules-for-match-pairs)外，您还可以指定删除重复规则。 *删除重复* 是匹配记录时的另一个过程。 它标识重复记录，并将它们合并成一个记录。 源记录会通过替代 ID 链接到合并的记录。

然后，将在跨实体匹配流程中使用经过删除重复的记录。 删除重复将对各个实体执行，并且可以配置有匹配对中使用的每个实体。

指定删除重复规则不是必需的。 如果未配置此类规则，将应用系统定义的规则。 它们会将所有记录合并为单个记录，然后将实体数据传递给跨实体匹配以提高性能。

### <a name="add-deduplication-rules"></a>添加删除重复规则

1. 转到 **数据** > **统一** > **匹配**。

1. 在 **合并重复** 部分中，选择 **设置实体**。 如果已创建删除重复规则，请选择 **编辑**。

1. 在 **合并首选项** 窗格中，选择要对其运行删除重复的实体。

1. 指定如何合并重复记录并选择以下三个选项之一：
   - **最多填充**：将属性字段填充最多的记录标识为入选记录。 这是默认的合并选项。
   - **最常使用**：根据最常使用标识入选记录。 需要日期或数字字段以定义近期性。
   - **最不常用**：根据最不常用标识入选记录。 需要日期或数字字段以定义近期性。
 
   > [!div class="mx-imgBorder"]
   > ![删除重复规则步骤 1](media/match-selfconflation.png "删除重复规则步骤 1")
 
1. 在选择实体并设置其合并首选项后，请选择 **添加规则** 以在实体级别定义删除重复规则。
   - **选择字段** 将列出该实体的所有可用字段。 选择要检查重复项的字段。 选择可能为每个客户所特有的字段。 例如，电子邮件地址，或者名称、市/县和电话号码的组合。
   - 指定标准化和精度设置。
   - 通过选择 **添加条件** 来定义其他条件。
 
   > [!div class="mx-imgBorder"]
   > ![删除重复规则步骤 2](media/match-selfconflation-rules.png "删除重复规则步骤 2")

  您可以为一个实体创建多个删除重复规则。 

1. 现在，运行匹配流程将根据在删除重复规则中定义的条件对记录进行分组。 对记录进行分组后，将应用合并策略以标识入选记录。

1. 然后，该入选记录将与非入选记录（例如，备用 ID）一起传递给跨实体匹配，以提高匹配质量。

1. 任何定义的自定义匹配规则都将覆盖删除重复规则。 如果删除重复规则确定匹配的记录，并且将某个自定义匹配规则设置为永不匹配这些记录，则将无法匹配这两个记录。

1. 在[运行匹配流程](#run-the-match-process)后，您将在重要指标磁贴中看到删除重复统计信息。

### <a name="deduplication-output-as-an-entity"></a>实体形式的删除重复输出

删除重复过程会为匹配对中每个实体创建一个新实体，以标识删除了重复数据的记录。 这些实体可以与名称为 **Deduplication_DataSource_Entity** 的 **实体** 页面内 **系统** 部分中的 **ConflationMatchPairs:CustomerInsights** 一起找到。

删除重复输出实体包含以下信息：
- ID/键
  - 主键字段及其备用 ID 字段。 备用 ID 字段由为一条记录标识的所有备用 ID 组成。
  - Deduplication_GroupId 字段显示在实体中标识的组或群集，该组或群集根据指定的删除重复字段将所有相似记录归组。 它用于系统处理目的。 如果没有指定手动删除重复规则并且系统定义的删除重复规则适用，则您可能在重复删除输出实体中找不到此字段。
  - Deduplication_WinnerId：此字段包含标识的组或群集中的获胜者 ID。 如果 Deduplication_WinnerId 与记录的主键值相同，则这意味着该记录是入选记录。
- 用于定义删除重复规则的字段。
- “规则”和“分数”字段，分别用于表示所应用的删除重复规则以及匹配算法返回的分数。
   
## <a name="run-the-match-process"></a>运行匹配流程

利用配置的匹配规则（包括跨实体匹配和删除重复规则），您可以运行匹配流程。 

转到 **数据** > **统一** > **匹配**，并选择 **运行** 以开始此流程。 匹配算法需要一些时间才能完成，而且您直到匹配算法完成后才能更改配置。 要进行更改，您可以取消运行。 选择该作业的状态，然后选择 **进度详细信息** 窗格上的 **取消作业**。

您可以在 **实体** 页上查找成功运行的结果，统一客户配置文件实体。 统一客户实体在 **配置文件** 部分中称为 **客户**。 第一次成功运行匹配可创建统一的 *客户* 实体。 所有后续匹配运行都将展开该实体。

> [!TIP]
> 对于任务/流程，有[六种类型的状态](system.md#status-types)。 此外，大多数流程[取决于其他下游流程](system.md#refresh-policies)。 可以选择流程状态以查看有关整个作业的进度的详细信息。 在选择一个作业任务的 **查看详细信息** 后，您会发现其他信息：处理时间、上次处理日期以及与该任务相关的所有错误和警告。

## <a name="review-and-validate-your-matches"></a>预览和验证匹配

转到 **数据** > **统一** > **匹配**，以评估匹配对的质量并在必要时进行优化。

页面顶部的磁贴显示关键指标，并汇总匹配的记录和重复项的数量。

:::image type="content" source="media/match-KPIs.png" alt-text="包含数字和详细信息的“匹配”页上关键度量的已裁剪屏幕截图。":::

- **唯一源记录** 显示上一次匹配运行中处理的单个源记录的数量。
- **匹配的记录和非匹配记录** 突出显示处理匹配规则后保留的唯一记录数。
- **仅匹配的记录** 只显示所有匹配对中的匹配数。

您可以在 **匹配的记录详细信息** 表中评估每个匹配对及其规则的结果。 将来自匹配对的记录数与成功匹配的记录的百分比进行比较。

查看匹配对的规则，以在规则级别查看成功匹配记录的百分比。 选择省略号 (...)，然后选择 **匹配预览**，以在规则级别查看所有这些记录。 建议您查看一些记录，以验证它们是否匹配。

尝试不同的条件精度阈值以查找最佳值。

  1. 选择要试用的规则的相应省略号 (...) 并选择 **编辑**。

  2. 在要修改的条件中更改精度值。

  3. 选择 **预览**，以便查看所选条件的匹配和非匹配记录的数量。

## <a name="manage-match-rules"></a>管理匹配规则

您可以重新配置和细微调整大部分匹配参数。

:::image type="content" source="media/match-rules-management.png" alt-text="包含匹配规则选项的下拉菜单的屏幕截图。":::

- 如果定义了多个规则，**更改规则的顺序**。 您可以通过选择 **上移** 和 **下移** 选项或者通过拖放来对匹配规则重新排序。

- 通过选择 **编辑** 来 **更改规则条件** 并选择不同的字段。

- 用于从匹配过程中排除匹配规则时保留匹配规则的 **停用规则**。

- **复制规则**：如果已定义匹配规则并且希望创建包含修改的类似规则，请选择 **复制**。

- 通过选择 **删除** 符号来 **删除规则**。

## <a name="specify-custom-match-conditions"></a>指定自定义匹配条件

可以指定其中包含始终应或永不应匹配的记录的条件。 可以上载这些规则来替代标准匹配过程。 例如，如果记录中有 John Doe I 和 John Doe II，则系统可能会将它们作为一个人进行匹配。 通过自定义匹配规则，您可以指定其配置文件指不同的人员。 

1. 转到 **数据** > **统一** > **匹配**，并在 **匹配的记录详细信息** 部分中选择 **自定义匹配**。

  :::image type="content" source="media/custom-match-create.png" alt-text="匹配规则部分的屏幕截图，其中突出显示了“自定义匹配”控件。":::

1. 如果未设置自定义匹配规则，将会看到包含更多详细信息的新 **自定义匹配** 窗格。

1. 选择 **填写模板** 以获取一个模板文，用于指定始终应或永不应匹配哪些实体中的哪些记录。 您需要分别填写两个不同文件中的“始终匹配”记录和“永不匹配”记录。

1. 此模板中包含用于指定实体的字段和要在自定义匹配中使用的实体主键。 例如，如果您希望 *销售* 实体中的主键 *12345* 始终与 *联系人* 实体中的主键 *34567* 匹配，则填写以下模板：
    - 实体 1：销售
    - 实体 1 键：12345
    - 实体 2：联系人
    - 实体 2 键：34567

   同一个模板文件可以指定多个实体的自定义匹配记录。
   
   如果要为实体上的删除重复操作指定自定义匹配，请提供与 Entity1 和 Entity2 相同的实体，并设置不同的主键值。

1. 添加要应用的所有替代项之后，保存模板文件。

1. 转到 **数据** > **数据源** 并将模板文件作为新实体引入。 引入后，可以将其用于指定匹配配置。

1. 上传文件且实体可用之后，再次选择 **自定义匹配** 选项。 将看到用于指定要包含的实体的选项。 从下拉菜单选择所需实体。

   :::image type="content" source="media/custom-match-overrides.png" alt-text="用于选择自定义匹配方案替代的对话框的屏幕截图。":::

1. 选择要用于 **始终匹配** 和 **永不匹配** 的实体，然后选择 **完成**。

1. 选择 **匹配** 页上的 **保存** 以应用自定义匹配配置。

1. 选择 **匹配** 页上的 **运行** 以开始匹配流程。 自定义匹配配置会替代其他指定的匹配规则。

> [!TIP]
> 转到 **数据** > **实体**，并查看 **ConflationMatchPair** 实体，以确认应用了替代。

## <a name="next-step"></a>下一步

完成至少一个匹配对的匹配过程后，可以通过浏览 [**合并**](merge-entities.md)主题解决数据中可能的冲突。


[!INCLUDE[footer-include](../includes/footer-banner.md)]
