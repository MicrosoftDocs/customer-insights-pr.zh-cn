---
title: 机器学习工作室（经典）试验
description: 在 Dynamics 365 Customer Insights 中使用机器学习工作室（经典）模型。
ms.date: 12/03/2020
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: conceptual
author: m-hartmann
ms.author: mhart
ms.reviewer: ameetj
manager: shellyha
ms.openlocfilehash: 556b6810db0ed2733a3f086291757bd85b77e371
ms.sourcegitcommit: a9b2cf598f256d07a48bba8617347ee90024a1dd
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/03/2020
ms.locfileid: "4669007"
---
# <a name="use-models-based-on-azure-machine-learning-studio-classic"></a><span data-ttu-id="131db-103">基于 Azure 机器学习工作室（经典）使用模型</span><span class="sxs-lookup"><span data-stu-id="131db-103">Use models based on Azure Machine Learning Studio (classic)</span></span>

<span data-ttu-id="131db-104">Dynamics 365 Customer Insights 中的统一数据是构建可生成其他业务见解的机器学习模型的来源。</span><span class="sxs-lookup"><span data-stu-id="131db-104">The unified data in Dynamics 365 Customer Insights is a source for building machine learning models that can generate additional business insights.</span></span> <span data-ttu-id="131db-105">Customer Insights 与机器学习工作室（经典）集成以使用您自己的自定义模型。</span><span class="sxs-lookup"><span data-stu-id="131db-105">Customer Insights integrates with Machine Learning Studio (classic) to use your own custom models.</span></span> <span data-ttu-id="131db-106">若要了解在 Azure 机器学习中开发的模型如何与 Customer Insights 集成，请参阅 [Azure 机器学习试验](azure-machine-learning-experiments.md)。</span><span class="sxs-lookup"><span data-stu-id="131db-106">To see how models developed in Azure Machine Learning are integrated with Customer Insights, see [Azure Machine Learning experiments](azure-machine-learning-experiments.md).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="131db-107">先决条件</span><span class="sxs-lookup"><span data-stu-id="131db-107">Prerequisites</span></span>

- <span data-ttu-id="131db-108">Customer Insights 访问权限</span><span class="sxs-lookup"><span data-stu-id="131db-108">Access to Customer Insights</span></span>
- <span data-ttu-id="131db-109">有效的 Azure Enterprise 订阅</span><span class="sxs-lookup"><span data-stu-id="131db-109">Active Azure Enterprise subscription</span></span>
- [<span data-ttu-id="131db-110">统一客户配置文件</span><span class="sxs-lookup"><span data-stu-id="131db-110">Unified customer profiles</span></span>](data-unification.md)
- <span data-ttu-id="131db-111">[实体导出到 Azure Blob 存储](export-azure-blob-storage.md)设置</span><span class="sxs-lookup"><span data-stu-id="131db-111">[Entity export to Azure Blob storage](export-azure-blob-storage.md) set up</span></span>

## <a name="set-up-machine-learning-studio-classic"></a><span data-ttu-id="131db-112">设置机器学习工作室（经典）</span><span class="sxs-lookup"><span data-stu-id="131db-112">Set up Machine Learning Studio Classic</span></span>

<span data-ttu-id="131db-113">在第一步中，我们需要创建工作区并打开机器学习工作室（经典）。</span><span class="sxs-lookup"><span data-stu-id="131db-113">In a first step, we need to create a workspace for and open the Machine Learning Studio (classic).</span></span>

1. <span data-ttu-id="131db-114">转到 [https://www.portal.azure.com](https://www.portal.azure.com/) 并登录。</span><span class="sxs-lookup"><span data-stu-id="131db-114">Go to [https://www.portal.azure.com](https://www.portal.azure.com/) and sign in.</span></span>

1. <span data-ttu-id="131db-115">选择 **创建资源**。</span><span class="sxs-lookup"><span data-stu-id="131db-115">Select **Create a resource**.</span></span>

1. <span data-ttu-id="131db-116">搜索 **机器学习工作室工作区**，然后选择 **创建**。</span><span class="sxs-lookup"><span data-stu-id="131db-116">Search **Machine Learning Studio Workspace** and select **Create**.</span></span>

1. <span data-ttu-id="131db-117">输入[创建工作区](https://docs.microsoft.com/azure/machine-learning/studio/create-workspace)所需的详细信息。</span><span class="sxs-lookup"><span data-stu-id="131db-117">Enter the required details to [create the workspace](https://docs.microsoft.com/azure/machine-learning/studio/create-workspace).</span></span> <span data-ttu-id="131db-118">基于您计划导入的数据量选择 **Web 服务计划定价层**。</span><span class="sxs-lookup"><span data-stu-id="131db-118">Choose the **Web service plan pricing tier** based on the amount of data you plan to import.</span></span> <span data-ttu-id="131db-119">为了获得最佳性能，请选择地理位置最靠近您的 **位置**。</span><span class="sxs-lookup"><span data-stu-id="131db-119">For best performance, select the **Location** that is geographically closest to you.</span></span>

1. <span data-ttu-id="131db-120">创建资源后，将显示机器学习工作室工作区仪表板。</span><span class="sxs-lookup"><span data-stu-id="131db-120">After creating the resource, the Machine Learning Studio workspace dashboard will appear.</span></span> <span data-ttu-id="131db-121">选择 **启动机器学习工作室**。</span><span class="sxs-lookup"><span data-stu-id="131db-121">Select **Launch Machine Learning Studio**.</span></span>

   ![Azure 机器学习工作室用户界面](media/azure-machine-learning-studio.png)

## <a name="work-with-azure-machine-learning-studio"></a><span data-ttu-id="131db-123">使用 Azure 机器学习工作室</span><span class="sxs-lookup"><span data-stu-id="131db-123">Work with Azure Machine Learning Studio</span></span>

<span data-ttu-id="131db-124">现在，您可以创建一个新试验，或从示例库导入现有试验模板。</span><span class="sxs-lookup"><span data-stu-id="131db-124">You can now create a new experiment, or import an existing experiment template from the sample gallery.</span></span> <span data-ttu-id="131db-125">以下是用于三种标准场景的试验示例：</span><span class="sxs-lookup"><span data-stu-id="131db-125">There are sample experiments for three standard scenarios:</span></span>

- [<span data-ttu-id="131db-126">流失预测</span><span class="sxs-lookup"><span data-stu-id="131db-126">Churn prediction</span></span>](#churn-analysis)

- [<span data-ttu-id="131db-127">客户生命周期值</span><span class="sxs-lookup"><span data-stu-id="131db-127">Customer lifetime value</span></span>](#customer-lifetime-value-prediction)

- [<span data-ttu-id="131db-128">产品建议或下一个最佳操作</span><span class="sxs-lookup"><span data-stu-id="131db-128">Product recommendation or next best action</span></span>](#productrecommendation-or-next-best-action)

1. <span data-ttu-id="131db-129">如果您从图库创建新试验或使用试验模板，则需要配置 **导入数据** 属性。</span><span class="sxs-lookup"><span data-stu-id="131db-129">If you create a new experiment or use an experiment template from the gallery, you need to configure the **Import Data** properties.</span></span> <span data-ttu-id="131db-130">使用引导式体验或直接提供详细信息以访问包含您的数据的 Azure Blob 存储。</span><span class="sxs-lookup"><span data-stu-id="131db-130">Use the guided experience or directly provide details to access the Azure Blob Storage that contains your data.</span></span>  

   ![Azure 机器学习工作室试验](media/azure-machine-learning-studio-experiment.png)

1. <span data-ttu-id="131db-132">现在，您可以构建自定义处理管道来清理和预处理数据、提取特征，以及训练合适的模型。</span><span class="sxs-lookup"><span data-stu-id="131db-132">Now you can build a custom processing pipeline to clean and preprocess the data, extract features, and train a suitable model.</span></span>

1. <span data-ttu-id="131db-133">测试和优化模型性能。</span><span class="sxs-lookup"><span data-stu-id="131db-133">Test and optimize the model performance.</span></span>

1. <span data-ttu-id="131db-134">当您对模型的质量感到满意时，选择 **设置 Web 服务** > **预测性 Web 服务**。</span><span class="sxs-lookup"><span data-stu-id="131db-134">When you’re satisfied with the quality of a model, select **Set up web service** > **Predictive Web Service**.</span></span> <span data-ttu-id="131db-135">此选项将训练后的模型和特征化管道从训练试验导入到预测性服务。</span><span class="sxs-lookup"><span data-stu-id="131db-135">This option imports the trained model and the featurization pipeline from the training experiment to a predictive service.</span></span> <span data-ttu-id="131db-136">预测性服务可以采用训练试验中使用的架构获取另一组输入数据，来进行预测。</span><span class="sxs-lookup"><span data-stu-id="131db-136">The predictive service can take another set of input data with the schema used in the training experiment to make predictions.</span></span>

   ![设置预测性 Web 服务](media/predictive-webservice-control.png)

1. <span data-ttu-id="131db-138">预测性 Web 服务试验成功后，您可以将其部署为进行自动计划。</span><span class="sxs-lookup"><span data-stu-id="131db-138">Once the predictive web service experiment is successful, you can deploy it for auto scheduling.</span></span> <span data-ttu-id="131db-139">要使 Web 服务与 Customer Insights 一起使用，请选择 **部署 Web 服务** > **部署 Web 服务[新]预览**。</span><span class="sxs-lookup"><span data-stu-id="131db-139">To have the web service work with Customer Insights, select **Deploy Web Service** > **Deploy Web Service [New] Preview**.</span></span> <span data-ttu-id="131db-140">[了解有关部署 Web 服务的详细信息](https://docs.microsoft.com/azure/machine-learning/studio/deploy-a-machine-learning-web-service)。</span><span class="sxs-lookup"><span data-stu-id="131db-140">[Learn more about deploying a web service](https://docs.microsoft.com/azure/machine-learning/studio/deploy-a-machine-learning-web-service).</span></span>

   ![部署预测性 Web 服务](media/predictive-webservice-deploy.png)

## <a name="sample-models-from-the-gallery"></a><span data-ttu-id="131db-142">库中的模型示例</span><span class="sxs-lookup"><span data-stu-id="131db-142">Sample models from the gallery</span></span>

<span data-ttu-id="131db-143">在本文中，我们将使用虚拟的 Contoso 酒店场景作为模型。</span><span class="sxs-lookup"><span data-stu-id="131db-143">We'll use a fictitious scenario of Contoso Hotel for the models in this article.</span></span> <span data-ttu-id="131db-144">Contoso 酒店收集以下数据：</span><span class="sxs-lookup"><span data-stu-id="131db-144">Contoso Hotel gathers the following data:</span></span>

- <span data-ttu-id="131db-145">由酒店住宿活动组成的 CRM 数据。</span><span class="sxs-lookup"><span data-stu-id="131db-145">CRM data consisting of hotel stay activity.</span></span> <span data-ttu-id="131db-146">此数据集包含有关每个注册客户的入住日期的信息。</span><span class="sxs-lookup"><span data-stu-id="131db-146">The data set includes information about the dates of stay for each registered customer.</span></span> <span data-ttu-id="131db-147">还包含有关预订、房间类型、支出明细等信息。</span><span class="sxs-lookup"><span data-stu-id="131db-147">It also contains information about the booking, room types, details of spend, and so on.</span></span> <span data-ttu-id="131db-148">数据跨度为四年，从 2014 年 1 月到 2018 年 1 月。</span><span class="sxs-lookup"><span data-stu-id="131db-148">The data spans four years, from January 2014 to January 2018.</span></span>
- <span data-ttu-id="131db-149">酒店来宾的客户资料。</span><span class="sxs-lookup"><span data-stu-id="131db-149">Customer profiles of hotel guests.</span></span> <span data-ttu-id="131db-150">这些资料包含有关每个客户的信息，包括他们的姓名、生日、邮政地址、性别和电话号码。</span><span class="sxs-lookup"><span data-stu-id="131db-150">These profiles contain information about each customer, including their name, birthdate, postal address, gender, and phone number.</span></span>
- <span data-ttu-id="131db-151">对酒店提供服务的使用情况，如水疗中心、洗衣房、WiFi 或快递。</span><span class="sxs-lookup"><span data-stu-id="131db-151">Usage of services offered by the hotel, such as the spa, laundry, WiFi, or courier.</span></span> <span data-ttu-id="131db-152">将为每个注册客户记录此信息。</span><span class="sxs-lookup"><span data-stu-id="131db-152">This information is logged for each registered customer.</span></span> <span data-ttu-id="131db-153">通常，服务的使用与住宿相关。</span><span class="sxs-lookup"><span data-stu-id="131db-153">Typically, use of services is linked with the stay.</span></span> <span data-ttu-id="131db-154">在某些情况下，客户不入住酒店也可以使用服务。</span><span class="sxs-lookup"><span data-stu-id="131db-154">In some cases, services can be used by customers without staying in the hotel.</span></span>

## <a name="churn-analysis"></a><span data-ttu-id="131db-155">流失分析</span><span class="sxs-lookup"><span data-stu-id="131db-155">Churn Analysis</span></span>

<span data-ttu-id="131db-156">流失分析适用于不同的业务领域。</span><span class="sxs-lookup"><span data-stu-id="131db-156">Churn analysis applies to different business areas.</span></span> <span data-ttu-id="131db-157">在此示例中，我们将专门在酒店服务上下文中查看服务流失，如上所述。</span><span class="sxs-lookup"><span data-stu-id="131db-157">In this example, we’re going to look at service churn, specifically in the context of hotel services as described above.</span></span> <span data-ttu-id="131db-158">它提供端到端模型管道的工作示例，可用作任何其他类型的流失模型的起点。</span><span class="sxs-lookup"><span data-stu-id="131db-158">It provides a working example of an end–to–end model pipeline that can be used as a starting point for any other type of churn model.</span></span>

### <a name="definition-of-churn"></a><span data-ttu-id="131db-159">定义流失</span><span class="sxs-lookup"><span data-stu-id="131db-159">Definition of Churn</span></span>

<span data-ttu-id="131db-160">流失的定义可能会因场景而异。</span><span class="sxs-lookup"><span data-stu-id="131db-160">The definition of churn can differ based on the scenario.</span></span> <span data-ttu-id="131db-161">在此示例中，过去一年未来过酒店的来宾应标记为已流失。</span><span class="sxs-lookup"><span data-stu-id="131db-161">In this example, a guest who hasn’t visited the hotel in the past year should be labeled as churned.</span></span>  

<span data-ttu-id="131db-162">试验模板可以从库中导入。</span><span class="sxs-lookup"><span data-stu-id="131db-162">The experiment template can be imported from the gallery.</span></span> <span data-ttu-id="131db-163">首先，请确保从 Azure Blob 存储导入 **酒店住宿活动**、**客户数据** 和 **服务使用数据** 的数据。</span><span class="sxs-lookup"><span data-stu-id="131db-163">First, ensure that you import the data for **Hotel Stay Activity**, **Customer data**, and **Service Usage Data** from Azure Blob storage.</span></span>

   ![为流失模型导入数据](media/import-data-azure-blob-storage.png)

### <a name="featurization"></a><span data-ttu-id="131db-165">特征化</span><span class="sxs-lookup"><span data-stu-id="131db-165">Featurization</span></span>

<span data-ttu-id="131db-166">根据流失的定义，我们首先确定将影响此标签的原始特征。</span><span class="sxs-lookup"><span data-stu-id="131db-166">Based on the definition of churn, we first identify the raw features that will influence the label.</span></span> <span data-ttu-id="131db-167">然后，我们将这些原始特征处理为可在机器学习模型中使用的数字特征。</span><span class="sxs-lookup"><span data-stu-id="131db-167">Then, we process these raw features into numerical features that can be used with machine learning models.</span></span> <span data-ttu-id="131db-168">在 Customer Insights 中进行数据集成，以便我们可以使用 *客户 ID* 加入这些表。</span><span class="sxs-lookup"><span data-stu-id="131db-168">Data integration happens in Customer Insights so we can join these tables by using the *Customer ID*.</span></span>

   ![联接导入的数据](media/join-imported-data.png)

<span data-ttu-id="131db-170">生成流失分析模型的特征化可能有些棘手。</span><span class="sxs-lookup"><span data-stu-id="131db-170">The featurization for building the model for churn analysis can be a little tricky.</span></span> <span data-ttu-id="131db-171">此数据是一个时间函数，每天记录新的酒店活动。</span><span class="sxs-lookup"><span data-stu-id="131db-171">The data is a function of time with new hotel activity recorded on daily basis.</span></span> <span data-ttu-id="131db-172">在特征化期间，我们想要从动态数据生成静态特征。</span><span class="sxs-lookup"><span data-stu-id="131db-172">During featurization, we want to generate static features from the dynamic data.</span></span> <span data-ttu-id="131db-173">在此情况下，我们通过一年的滑动窗口从酒店活动生成多个特征。</span><span class="sxs-lookup"><span data-stu-id="131db-173">In this case, we generate multiple features from hotel activity with a sliding window of one year.</span></span> <span data-ttu-id="131db-174">我们还使用一次性编码将房间类型或预订类型等分类特征扩展为单独特征。</span><span class="sxs-lookup"><span data-stu-id="131db-174">We also expand the categorical features like room type or booking type into separate features using one-hot encoding.</span></span>  

<span data-ttu-id="131db-175">最后的特征列表：</span><span class="sxs-lookup"><span data-stu-id="131db-175">Final list of features:</span></span>

| <span data-ttu-id="131db-176">**编号**</span><span class="sxs-lookup"><span data-stu-id="131db-176">**Number**</span></span>  | <span data-ttu-id="131db-177">**Original_Column**</span><span class="sxs-lookup"><span data-stu-id="131db-177">**Original_Column**</span></span>          | <span data-ttu-id="131db-178">**派生特征**</span><span class="sxs-lookup"><span data-stu-id="131db-178">**Derived Features**</span></span>                                                                                                                      |
|-------------|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="131db-179">1</span><span class="sxs-lookup"><span data-stu-id="131db-179">1</span></span>           | <span data-ttu-id="131db-180">房间类型</span><span class="sxs-lookup"><span data-stu-id="131db-180">Room Type</span></span>                    | <span data-ttu-id="131db-181">RoomTypeLargeCount、RoomTypeSmallCount</span><span class="sxs-lookup"><span data-stu-id="131db-181">RoomTypeLargeCount, RoomTypeSmallCount</span></span>                                                                                                    |
| <span data-ttu-id="131db-182">2</span><span class="sxs-lookup"><span data-stu-id="131db-182">2</span></span>           | <span data-ttu-id="131db-183">预订类型</span><span class="sxs-lookup"><span data-stu-id="131db-183">Booking Type</span></span>                 | <span data-ttu-id="131db-184">BookingTypeOnlineCount、BookingTypePhoneCallCount</span><span class="sxs-lookup"><span data-stu-id="131db-184">BookingTypeOnlineCount, BookingTypePhoneCallCount</span></span>                                                                                         |
| <span data-ttu-id="131db-185">3</span><span class="sxs-lookup"><span data-stu-id="131db-185">3</span></span>           | <span data-ttu-id="131db-186">旅行类别</span><span class="sxs-lookup"><span data-stu-id="131db-186">Travel Category</span></span>              | <span data-ttu-id="131db-187">TravelCategoryBusinessCount、TravelCategoryLeisureCount</span><span class="sxs-lookup"><span data-stu-id="131db-187">TravelCategoryBusinessCount, TravelCategoryLeisureCount</span></span>                                                                                   |
| <span data-ttu-id="131db-188">4</span><span class="sxs-lookup"><span data-stu-id="131db-188">4</span></span>           | <span data-ttu-id="131db-189">支出金额</span><span class="sxs-lookup"><span data-stu-id="131db-189">Dollars Spent</span></span>                | <span data-ttu-id="131db-190">TotalDollarSpent</span><span class="sxs-lookup"><span data-stu-id="131db-190">TotalDollarSpent</span></span>                                                                                                                          |
| <span data-ttu-id="131db-191">5</span><span class="sxs-lookup"><span data-stu-id="131db-191">5</span></span>           | <span data-ttu-id="131db-192">入住和退房日期</span><span class="sxs-lookup"><span data-stu-id="131db-192">Check-in and Checkout dates</span></span>  | <span data-ttu-id="131db-193">StayDayCount、StayDayCount2016、StayDayCount2015、StayDayCount2014、StayCount、StayCount2016。</span><span class="sxs-lookup"><span data-stu-id="131db-193">StayDayCount, StayDayCount2016, StayDayCount2015, StayDayCount2014, StayCount, StayCount2016.</span></span> <span data-ttu-id="131db-194">StayCount2015、StayCount2014</span><span class="sxs-lookup"><span data-stu-id="131db-194">StayCount2015, StayCount2014</span></span>                |
| <span data-ttu-id="131db-195">6</span><span class="sxs-lookup"><span data-stu-id="131db-195">6</span></span>           | <span data-ttu-id="131db-196">服务用户</span><span class="sxs-lookup"><span data-stu-id="131db-196">Service Usage</span></span>                | <span data-ttu-id="131db-197">UsageTenure、ConciergeUsage、CourierUsage、DryCleaningUsage、GymUsage、PhoneUsage、RestaurantUsage、SpaUsage、TelevisionUsage、WifiUsage</span><span class="sxs-lookup"><span data-stu-id="131db-197">UsageTenure, ConciergeUsage, CourierUsage, DryCleaningUsage, GymUsage, PhoneUsage, RestaurantUsage, SpaUsage, TelevisionUsage, WifiUsage</span></span>  |

### <a name="model-selection"></a><span data-ttu-id="131db-198">模型选择</span><span class="sxs-lookup"><span data-stu-id="131db-198">Model selection</span></span>

<span data-ttu-id="131db-199">现在，我们需要选择要使用的最佳算法。</span><span class="sxs-lookup"><span data-stu-id="131db-199">Now we need to choose the optimal algorithm to use.</span></span> <span data-ttu-id="131db-200">在此例中，大多数特征基于分类特征。</span><span class="sxs-lookup"><span data-stu-id="131db-200">In this case, most features are based on categorical features.</span></span> <span data-ttu-id="131db-201">通常，基于决策树的模型效果较好。</span><span class="sxs-lookup"><span data-stu-id="131db-201">Typically, decision tree–based models work well.</span></span> <span data-ttu-id="131db-202">如果仅存在数字特征，神经网络可能是更好的选择。</span><span class="sxs-lookup"><span data-stu-id="131db-202">If there are only numerical features, neural networks could be a better choice.</span></span> <span data-ttu-id="131db-203">在这种情况下，支持向量机 (SVM) 也很适合；但是，需要进行大量调整才能获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="131db-203">Support vector machine (SVM) also is a good candidate in such situations; however, it needs quite a bit of tuning to extract the best performance.</span></span> <span data-ttu-id="131db-204">我们选择的第一个模型是 **两类提升决策树**，第二个模型是 **两类 SVM**。</span><span class="sxs-lookup"><span data-stu-id="131db-204">We choose **Two-Class Boosted Decision Tree** as the first model of choice followed by **Two-Class SVM** as the second model.</span></span> <span data-ttu-id="131db-205">Azure 机器学习工作室可让您进行 A/B 测试，因此从两个模型而不是一个模型开始是有好处的。</span><span class="sxs-lookup"><span data-stu-id="131db-205">Azure Machine Learning Studio lets you do A/B testing, so it’s beneficial to start with two models rather than one.</span></span>

<span data-ttu-id="131db-206">下图显示了 Azure 机器学习工作室的模型训练和评估管道：</span><span class="sxs-lookup"><span data-stu-id="131db-206">The following image shows the model training and evaluation pipeline from Azure Machine Learning Studio:</span></span>

![Azure 机器学习工作室中的流失模型](media/azure-machine-learning-model.png)

<span data-ttu-id="131db-208">我们还应用称为 **排列特征重要性** 的技术，这是模型优化的重要方面。</span><span class="sxs-lookup"><span data-stu-id="131db-208">We also apply a technique called **Permutation Feature Importance**, an important aspect of model optimization.</span></span> <span data-ttu-id="131db-209">内置模型几乎看不到任何特定特征对最终预测的影响。</span><span class="sxs-lookup"><span data-stu-id="131db-209">Built-in models have little to no insight into the impact of any specific feature on the final prediction.</span></span> <span data-ttu-id="131db-210">特征重要性计算器使用自定义算法来计算单个特征对特定模型结果的影响。</span><span class="sxs-lookup"><span data-stu-id="131db-210">The feature importance calculator uses a custom algorithm to compute the influence of individual features on the outcome for a specific model.</span></span> <span data-ttu-id="131db-211">特征重要性标准化为 +1 到 -1 的值。</span><span class="sxs-lookup"><span data-stu-id="131db-211">The feature importance is normalized between +1 to -1.</span></span> <span data-ttu-id="131db-212">负面影响意味着相应的特征对结果具有与直觉相反的影响，应从模型中删除。</span><span class="sxs-lookup"><span data-stu-id="131db-212">A negative influence means the corresponding feature has counter-intuitive influence on the outcome and should be removed from the model.</span></span> <span data-ttu-id="131db-213">正面影响表明该特征对预测有重大贡献。</span><span class="sxs-lookup"><span data-stu-id="131db-213">A positive influence indicates the feature is contributing heavily towards the prediction.</span></span> <span data-ttu-id="131db-214">这些值不是相关系数，因为它们是不同的指标。</span><span class="sxs-lookup"><span data-stu-id="131db-214">These values aren't correlation coefficients as they are different metrics.</span></span> <span data-ttu-id="131db-215">有关详细信息，请参阅[排列特征重要性](https://docs.microsoft.com/azure/machine-learning/studio-module-reference/permutation-feature-importance)。</span><span class="sxs-lookup"><span data-stu-id="131db-215">For more information, see [Permutation Feature Importance](https://docs.microsoft.com/azure/machine-learning/studio-module-reference/permutation-feature-importance).</span></span>

<span data-ttu-id="131db-216">整个[流失试验在 Azure AI 库中提供](https://gallery.azure.ai/Experiment/Hotel-Churn-Predictive-Exp)。</span><span class="sxs-lookup"><span data-stu-id="131db-216">The entire [churn experiment is available in the Azure AI Gallery](https://gallery.azure.ai/Experiment/Hotel-Churn-Predictive-Exp).</span></span>

## <a name="customer-lifetime-value-prediction"></a><span data-ttu-id="131db-217">客户生命周期值预测</span><span class="sxs-lookup"><span data-stu-id="131db-217">Customer lifetime value prediction</span></span>

<span data-ttu-id="131db-218">客户生命周期价值 (CLTV) 计算是企业可用来评估和细分客户的关键指标之一。</span><span class="sxs-lookup"><span data-stu-id="131db-218">The customer lifetime value (CLTV) calculation is one of the key metrics that a business can use to assess and segment its customers.</span></span> <span data-ttu-id="131db-219">对于酒店企业而言，了解客户至关重要。</span><span class="sxs-lookup"><span data-stu-id="131db-219">For the hotel business, it’s critical to know their customers.</span></span> <span data-ttu-id="131db-220">例如，了解构成良好客户的因素是至关重要的信息。</span><span class="sxs-lookup"><span data-stu-id="131db-220">For example, understanding factors that make up good customers is crucial information.</span></span> <span data-ttu-id="131db-221">它可以帮助酒店管理层评估他们需要重点关注和改进的特征，以让高消费客户满意。</span><span class="sxs-lookup"><span data-stu-id="131db-221">It helps the hotel management assess which features they need to focus on and improve to satisfy their high paying customers.</span></span> <span data-ttu-id="131db-222">这些决策可能直接影响销售和收益。</span><span class="sxs-lookup"><span data-stu-id="131db-222">These decisions can have a direct impact on sales and earnings.</span></span>  

### <a name="definition-of-cltv"></a><span data-ttu-id="131db-223">定义 CLTV</span><span class="sxs-lookup"><span data-stu-id="131db-223">Definition of CLTV</span></span>

<span data-ttu-id="131db-224">对于此示例，我们将客户的 CLTV 定义为期望客户在接下来的 365 天内支出的总金额。</span><span class="sxs-lookup"><span data-stu-id="131db-224">For this example, we define the CLTV of a customer as the total dollar amount the customer is expected to spend in the next 365 days.</span></span> <span data-ttu-id="131db-225">我们将使用过去三年所有客户的数据来预测此值。</span><span class="sxs-lookup"><span data-stu-id="131db-225">We are going to use the past three years’ worth of data for all customers to predict this value.</span></span>

### <a name="featurization"></a><span data-ttu-id="131db-226">特征化</span><span class="sxs-lookup"><span data-stu-id="131db-226">Featurization</span></span>

<span data-ttu-id="131db-227">在此例中，特征化与流失场景很相似。</span><span class="sxs-lookup"><span data-stu-id="131db-227">In this case, featurization is going to be quite like the churn scenario.</span></span> <span data-ttu-id="131db-228">但是，标签和预测值与上面定义的不同。</span><span class="sxs-lookup"><span data-stu-id="131db-228">However, the labels and predicted values are different than defined above.</span></span>

### <a name="model-selection"></a><span data-ttu-id="131db-229">模型选择</span><span class="sxs-lookup"><span data-stu-id="131db-229">Model selection</span></span>

<span data-ttu-id="131db-230">由于预测值是一个正连续变量，因此预测 CLTV 是一个回归问题。</span><span class="sxs-lookup"><span data-stu-id="131db-230">Predicting the CLTV is a regression problem as the predicted value is a positive valued continuous variable.</span></span> <span data-ttu-id="131db-231">根据特征属性，我们选择 **提升决策树回归** 作为训练模型的一种算法，选择 **神经网络回归** 作为另一种算法。</span><span class="sxs-lookup"><span data-stu-id="131db-231">Based on the feature properties, we select **Boosted Decision Tree Regression** as one algorithm and **Neural Network Regression** as another algorithm to train the model.</span></span>

## <a name="product-recommendation-or-next-best-action"></a><span data-ttu-id="131db-232">产品建议或下一个最佳操作</span><span class="sxs-lookup"><span data-stu-id="131db-232">Product recommendation or Next Best Action</span></span>

<span data-ttu-id="131db-233">酒店场景中的产品建议被解释为酒店向客户提供的建议服务。</span><span class="sxs-lookup"><span data-stu-id="131db-233">Product recommendation in a hotel scenario is interpreted as recommending services offered by the hotel to the customers.</span></span> <span data-ttu-id="131db-234">目的是为客户选择适当的服务，以最大程度地增加他们对服务的使用。</span><span class="sxs-lookup"><span data-stu-id="131db-234">The objective is to choose the appropriate services for customers so that their usage is maximized.</span></span> <span data-ttu-id="131db-235">这类似于针对视频流服务用户的电影推荐。</span><span class="sxs-lookup"><span data-stu-id="131db-235">It’s similar to movie recommendations for video streaming service users.</span></span>

### <a name="definition-of-product-recommendation-or-next-best-action"></a><span data-ttu-id="131db-236">定义产品建议或下一个最佳操作</span><span class="sxs-lookup"><span data-stu-id="131db-236">Definition of Product Recommendation or Next Best Action</span></span>

<span data-ttu-id="131db-237">我们将目标定义为通过根据酒店客户的兴趣向他们提供最匹配的服务，来最大程度地提高使用服务的支出金额。</span><span class="sxs-lookup"><span data-stu-id="131db-237">We define the goal as maximizing the dollar amount of service usage by offering the best matching services to hotel customers according to their interest.</span></span>

### <a name="featurization"></a><span data-ttu-id="131db-238">特征化</span><span class="sxs-lookup"><span data-stu-id="131db-238">Featurization</span></span>

<span data-ttu-id="131db-239">与流失模型一样，我们将酒店 ServiceCustomerID 与 CustomerID 联接，以按照 CustomerID 一致地生成建议。</span><span class="sxs-lookup"><span data-stu-id="131db-239">Like the churn model, we are joining the hotel ServiceCustomerID with CustomerID in order to build recommendations consistently per CustomerID.</span></span>

![建议模型的特征化](media/azure-machine-learning-model-featurization.png)

<span data-ttu-id="131db-241">数据源自三个不同的实体，特征从这些实体中派生。</span><span class="sxs-lookup"><span data-stu-id="131db-241">The data is sourced from three different entities and features are derived from them.</span></span> <span data-ttu-id="131db-242">与流失或 CLTV 场景相比，建议问题的特征化有所不同。</span><span class="sxs-lookup"><span data-stu-id="131db-242">The featurization for the problem of recommendation is different compared to churn or CLTV scenarios.</span></span> <span data-ttu-id="131db-243">建议模型需要以三组特征的形式输入数据。</span><span class="sxs-lookup"><span data-stu-id="131db-243">The recommendation model needs input data in the form of three sets of features.</span></span>

### <a name="model-selection"></a><span data-ttu-id="131db-244">模型选择</span><span class="sxs-lookup"><span data-stu-id="131db-244">Model selection</span></span>

<span data-ttu-id="131db-245">我们使用称为 **训练 Matchbox 推荐器** 的算法来训练建议模型，从而预测产品或服务。</span><span class="sxs-lookup"><span data-stu-id="131db-245">We predict products or services by using the algorithm called **Train Matchbox Recommender** to train the recommendation model.</span></span>

![产品建议算法](media/azure-machine-learning-model-recommendation-algorithm.png)

<span data-ttu-id="131db-247">**训练 Matchbox 推荐器** 模型的三个输入端口获取培训服务使用数据、客户描述（可选）和服务描述。</span><span class="sxs-lookup"><span data-stu-id="131db-247">The three input ports for the **Train Matchbox Recommender** model takes in the training service usage data, customer description (optional), and service description.</span></span> <span data-ttu-id="131db-248">有三种不同的模型评分方法。</span><span class="sxs-lookup"><span data-stu-id="131db-248">There are three different ways of scoring the model.</span></span> <span data-ttu-id="131db-249">一种用于模型评估，其计算标准化折扣累积收益 (NDCG) 分数来对评级项目进行排名。</span><span class="sxs-lookup"><span data-stu-id="131db-249">One is for model evaluation where a Normalized Discounted Cumulative Gain (NDCG) score is calculated to rank the rated items.</span></span> <span data-ttu-id="131db-250">在此试验中，我们的 NDCG 分数为 0.97。</span><span class="sxs-lookup"><span data-stu-id="131db-250">In this experiment, we have the NDCG score as 0.97.</span></span> <span data-ttu-id="131db-251">另外两个选项是在整个可建议服务目录上对模型进行评分，或仅对用户之前未使用过的项目评分。</span><span class="sxs-lookup"><span data-stu-id="131db-251">The other two options are scoring the model on the entire recommendable service catalog, or scoring only on items that users have not used before.</span></span>

<span data-ttu-id="131db-252">进一步查看建议在整个服务目录上的分布情况，我们注意到，电话、WiFi 和快递是要建议的几个排名最靠前的服务。</span><span class="sxs-lookup"><span data-stu-id="131db-252">Looking further on the distributions of the recommendations on the entire service catalog, we notice that phone, WiFi, and courier are the top services to be recommended.</span></span> <span data-ttu-id="131db-253">这与我们从服务使用数据的分布中发现的一致：</span><span class="sxs-lookup"><span data-stu-id="131db-253">This is consistent with what we found from the distributions of the service consumption data:</span></span>

![建议模型输出](media/azure-machine-learning-model-output.png)

<span data-ttu-id="131db-255">整个[产品建议试验可在 Azure AI 库中访问。](https://gallery.azure.ai/Experiment/Recommendation-4)</span><span class="sxs-lookup"><span data-stu-id="131db-255">The entire [product recommendation experiment can be accessed in Azure AI Gallery.](https://gallery.azure.ai/Experiment/Recommendation-4)</span></span>

## <a name="integrate-custom-models"></a><span data-ttu-id="131db-256">集成自定义模型</span><span class="sxs-lookup"><span data-stu-id="131db-256">Integrate custom models</span></span>

<span data-ttu-id="131db-257">若要在 Customer Insights 中使用这些预测，您需要 **导出** 预测以及客户 ID。</span><span class="sxs-lookup"><span data-stu-id="131db-257">To use these predictions in Customer Insights, you need to **export** the predictions along with the customer IDs.</span></span> <span data-ttu-id="131db-258">[将其导出到相同的 Azure Blob 存储位置](https://docs.microsoft.com/azure/storage/common/storage-import-export-data-from-blobs)，您要向该位置导出元数据。</span><span class="sxs-lookup"><span data-stu-id="131db-258">[Export them to the same Azure Blob storage location](https://docs.microsoft.com/azure/storage/common/storage-import-export-data-from-blobs) that you export the source data to.</span></span> <span data-ttu-id="131db-259">可以将预测性 Web 服务计划为定期运行，然后更新分数。</span><span class="sxs-lookup"><span data-stu-id="131db-259">The predictive web service can be scheduled to run regularly and update the scores.</span></span>

<span data-ttu-id="131db-260">自定义模型生成的数据可用于进一步扩充您的客户数据。</span><span class="sxs-lookup"><span data-stu-id="131db-260">Data generated by the custom model can be used to further enrich your customer data.</span></span> <span data-ttu-id="131db-261">有关详细信息，请参阅[自定义机器学习模型](custom-models.md)。</span><span class="sxs-lookup"><span data-stu-id="131db-261">For more information, see [Custom machine learning models](custom-models.md).</span></span>
